---
title: 'Python Expression'
description: 'Learn how to use Python expressions in Julep task definitions'
icon: 'python'
---

# Python Expressions in Tasks

Julep tasks support Python expressions for dynamic value computation and data manipulation. This guide explains how to use them effectively.

## The Special `_` Variable

The underscore `_` is a special variable that serves three different purposes depending on where it's used:

1. **First Step Input**: In the first step of a task, `_` contains the execution input:
```yaml
# If task is executed with input `{"topic": "AI"}`
- evaluate:
    topic: _.topic  # Accesses the input "AI"
```

2. **Previous Step Output**: In any subsequent step, `_` contains the output from the previous step:
```yaml
- evaluate:
    results: _.split('\n')  # Splits previous step's output into lines
```

3. **Iterator Value**: In `foreach` and `map` steps, `_` represents the current item being iterated.
```yaml
# If the task is executed with input `{"questions": ["What is AI?", "What is Julep?"]}`
- foreach:
    in: _.questions
    do:
      - wait_for_input:
          info:
            "message": _  # _ is each question
```

## Where Python Expressions Are Used

Python expressions can be used in various task steps. For a complete list of step types and their syntax, refer to the [Step Types table in the README](https://github.com/julep-ai/julep#types-of-workflow-steps).

Common places include:
- `evaluate` steps
- Tool `arguments`
- `if` conditions
- `foreach` and `map` iterations

## Available Functions and Libraries

The following Python functions and libraries are available for use in expressions:

### Basic Python Builtins
- `abs`, `all`, `any`, `bool`, `dict`, `enumerate`
- `float`, `int`, `len`, `list`, `map`, `max`, `min`
- `round`, `set`, `str`, `sum`, `tuple`, `zip`, `reduce`

### Safe Versions of Functions
- `range`: Safe version with size limits (max 1,000,000 elements)
- `load_json`: Safe JSON parsing (wrapper around `json.loads` with size limits)
- `load_yaml`: Safe YAML parsing (wrapper around `yaml.load` with size limits)
- `dump_json`: JSON serialization
- `dump_yaml`: YAML serialization
- `extract_json`: Extract and parse JSON from text

Example using safe JSON and YAML functions:
```yaml
- evaluate:
    # Parse JSON string with size limit of 1MB
    data: load_json(_.json_string)
    
    # Parse YAML string with size limit of 1MB
    config: load_yaml(_.yaml_string)
    
    # Extract JSON from text that might contain markdown code blocks
    extracted_content: extract_json('Here is some JSON: ```json\n{"key": "value"}\n```')
```

### Standard Library Modules
- `re`: Regular expressions (using re2)
- `json`: JSON operations
- `yaml`: YAML operations
- `string`: String constants and operations
- `datetime`: Date and time operations
- `math`: Mathematical functions
- `statistics`: Statistical operations
- `base64`: Base64 encoding/decoding
- `urllib.parse`: URL parsing operations
- `random`: Random number generation
- `time`: Time operations

For the complete list of available functions and their safe implementations, refer to the [utils.py](https://github.com/julep-ai/julep/blob/main/agents-api/agents_api/activities/utils.py) file in the source code.

## Example Usage

Here's a practical example combining different aspects of Python expressions:

```yaml
name: Data Processing Task

main:
  # Using _ as input
  - evaluate:
      topics: _.topics  # Access input topics

  # Using _ as previous output
  - evaluate:
      filtered_topics: [t for t in _.topics if len(t) > 3]

  # Using _ in foreach
  - foreach:
      in: _.filtered_topics
      do:
        - tool: web_search
          arguments:
            query: "'Latest news about ' + _"  # _ is each topic
```

## Security Note

All Python expressions are executed in a sandboxed environment with:
- Limited available functions
- Maximum string length restrictions
- Collection size limits
- Execution time limits

This ensures safe execution while providing necessary functionality for task workflows.